# Cost Estimator (Java)

This project aims to replicate the model of [our Python estimator](https://github.com/elasql/cost-estimator) in Java. This allows us to port this model to ElaSQL.

## Prerequisite

- Java Development Kit 8+
- Python >= 3.8
- Maven

## Assumptions for the Training Data Set

- All values except the following fields can be read as `Double`s
  - `Transaction ID`: Long
  - `Is Master`: Boolean
  - `Is Distributed`: Boolean
  - `Start Time`: Long
- All arrays store features of every server so that we can separate the features for each individual servers from the arrays

## Build

```
> mvn package
```

This command generates a file called `estimator-[version number]-jar-with-dependencies.jar`, which includes all the dependencies that this program needs and information for startting the program, in `target` directory.

## Run

There are two steps for training a model:

1. Preprocess using `preprocessor.py`
2. Train models using the jar file

### Preprocess

This step processes the log files (e.g., `transaction-features.csv` and `transaction-latency-server-*.csv`) generated by ElaSQL  into the training data set that is ready to be used in the later training process.

```
> python preprocessor.py [Config File] [Input Dir] [Output Dir] 
```

Parameters:

- `[Config File]`: the configurations for the preprocessing. You can find an example, `example-config.toml`.
- `[Input Dir]`: the directory where the RAW log files are
- `[Output Dir]`: the directory for preprocessed training data set

### Training

This step trains a cost estimator and saves the model.

```
> java -jar [Jar File] train [Data Set Dir] [Model Save Dir]
```

- `[Jar File]`: the path to the built jar file. This is usually `target/estimator-[version number]-jar-with-dependencies.jar`
- `[Data Set Dir]`: the path to the directory that holds the training data set
- `[Model Save Dir]`: the path to save the model

Note that this program also needs a configuration file. We assume the configuration file is called `config.toml` and is placed in the working directory. If it is not the case, you can use the following command to specify the path to the file:

```
> java -jar [Jar File] train -c [Config File] [Data Set Dir] [Model Save Dir]
```

- `[Config File]`: the path to the configuration file. The default is `./config.toml`.

